---
---
<header class="fixed top-0 left-0 right-0 z-50 bg-header-gradient shadow-md transition-all duration-300">
    <nav class="container mx-auto px-4 py-3">
        <div class="flex items-center justify-between">
            <!-- Logo -->
            <div class="flex items-center">
                <a href="/" class="hover:opacity-80 transition-opacity">
                    <img src="/logo.png" alt="Dale Delivery" class="h-14 w-full object-contain"/>
                </a>
            </div>

            <!-- Desktop Navigation -->
            <div class="hidden md:flex items-center space-x-6 lg:space-x-8">
                <a href="#inicio"
                   class="text-white hover:text-primary-100 transition-colors duration-200 font-bold text-sm">
                    INICIO
                </a>
                <a href="#servicios"
                   class="text-white hover:text-primary-100 transition-colors duration-200 font-bold text-sm">
                    SERVICIOS
                </a>
                <a href="#por-que-elegirnos"
                   class="text-white hover:text-primary-100 transition-colors duration-200 font-bold text-sm">
                    ¿POR QUÉ ELEGIRNOS?
                </a>
                <a href="#contacto"
                   class="text-white hover:text-primary-100 transition-colors duration-200 font-bold text-sm">
                    CONTÁCTANOS
                </a>
            </div>

            <!-- Mobile Menu Button -->
            <button
                    class="md:hidden text-white hover:text-primary-100 transition-colors duration-200 p-2 relative menu-btn focus:outline-none focus:ring-2 focus:ring-white/50 rounded"
                    id="mobile-menu-btn"
                    aria-label="Abrir menú"
                    aria-expanded="false"
                    type="button"
            >
                <svg class="w-6 h-6 hamburger-icon transition-all duration-300" fill="none" stroke="currentColor"
                     viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M4 6h16M4 12h16M4 18h16"></path>
                </svg>
                <svg class="w-6 h-6 close-icon absolute top-2 left-2 opacity-0 transition-all duration-300"
                     fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>

        <!-- Mobile Navigation - CRÍTICO: sin max-height inicial -->
        <div class="mobile-menu md:hidden transition-all duration-300 ease-in-out"
             id="mobile-menu">
            <div class="pt-4 pb-4 border-t border-primary-400 mt-4">
                <div class="flex flex-col space-y-3">
                    <a href="#inicio"
                       class="text-white hover:text-primary-100 hover:bg-primary-600 transition-all duration-200 font-medium text-sm px-4 py-3 rounded-lg mobile-link block">
                        INICIO
                    </a>
                    <a href="#servicios"
                       class="text-white hover:text-primary-100 hover:bg-primary-600 transition-all duration-200 font-medium text-sm px-4 py-3 rounded-lg mobile-link block">
                        SERVICIOS
                    </a>
                    <a href="#por-que-elegirnos"
                       class="text-white hover:text-primary-100 hover:bg-primary-600 transition-all duration-200 font-medium text-sm px-4 py-3 rounded-lg mobile-link block">
                        ¿POR QUÉ ELEGIRNOS?
                    </a>
                    <a href="#contacto"
                       class="text-white hover:text-primary-100 hover:bg-primary-600 transition-all duration-200 font-medium text-sm px-4 py-3 rounded-lg mobile-link block">
                        CONTÁCTANOS
                    </a>
                </div>
            </div>
        </div>
    </nav>
</header>

<script>
    // Función simplificada para inicializar el menú móvil
    function initializeMobileMenu() {
        console.log('Inicializando menú móvil...');

        const mobileMenu = document.getElementById('mobile-menu');
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');

        // Guard clause con verificación de null
        if (!mobileMenu || !mobileMenuBtn) {
            console.error('No se encontraron los elementos del menú móvil');
            return;
        }

        console.log('Elementos del menú encontrados');

        // Establecer estado inicial cerrado
        mobileMenu.style.maxHeight = '0px';
        mobileMenu.style.overflow = 'hidden';

        let isMenuOpen = false;

        function toggleMenu() {
            // Verificación adicional por si los elementos se eliminan del DOM
            if (!mobileMenu || !mobileMenuBtn) {
                console.error('Los elementos del menú ya no están disponibles');
                return;
            }

            console.log('Toggle menu, estado actual:', isMenuOpen ? 'ABIERTO' : 'CERRADO');

            isMenuOpen = !isMenuOpen;

            if (isMenuOpen) {
                // Abrir menú
                mobileMenu.style.maxHeight = '300px';
                mobileMenuBtn.classList.add('menu-open');
                mobileMenuBtn.setAttribute('aria-expanded', 'true');
                console.log('Menú ABIERTO');
            } else {
                // Cerrar menú
                mobileMenu.style.maxHeight = '0px';
                mobileMenuBtn.classList.remove('menu-open');
                mobileMenuBtn.setAttribute('aria-expanded', 'false');
                console.log('Menú CERRADO');
            }
        }

        function closeMenu() {
            if (isMenuOpen) {
                toggleMenu();
            }
        }

        // Event listener para el botón del menú
        mobileMenuBtn.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            console.log('Click en botón del menú');
            toggleMenu();
        });

        // Cerrar menú al hacer click en enlaces
        const mobileLinks = document.querySelectorAll('.mobile-link');
        console.log('Enlaces móviles encontrados:', mobileLinks.length);

        mobileLinks.forEach((link, index) => {
            link.addEventListener('click', () => {
                console.log('Click en enlace', index + 1, ', cerrando menú');
                closeMenu();
            });
        });

        // Cerrar menú al hacer click fuera - CON TIPADO CORRECTO
        document.addEventListener('click', (e) => {
            const header = document.querySelector('header');
            const target = e.target as HTMLElement | null;

            if (isMenuOpen && header && target && !header.contains(target)) {
                console.log('Click fuera del header, cerrando menú');
                closeMenu();
            }
        });

        // Cerrar menú al redimensionar a desktop
        window.addEventListener('resize', () => {
            if (window.innerWidth >= 768 && isMenuOpen) {
                console.log('Cambio a desktop, cerrando menú');
                closeMenu();
            }
        });

        // Smooth scroll - CON TIPADO CORRECTO
        const allLinks = document.querySelectorAll<HTMLAnchorElement>('a[href^="#"]');
        allLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();

                const href = link.getAttribute('href');
                if (!href) return;

                const target = document.querySelector(href) as HTMLElement | null;
                if (target) {
                    const headerHeight = 80;
                    const targetPosition = target.offsetTop - headerHeight;

                    window.scrollTo({
                        top: targetPosition,
                        behavior: 'smooth'
                    });
                }
            });
        });

        console.log('Menú móvil inicializado correctamente');
    }

    // Inicialización robusta
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeMobileMenu);
    } else {
        initializeMobileMenu();
    }

    // Para Astro routing
    document.addEventListener('astro:page-load', initializeMobileMenu);
</script>

<style>
    /* CRÍTICO: Estilos del menú móvil */
    .mobile-menu {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Estado abierto del menú */
    .mobile-menu.menu-open {
        max-height: 300px;
    }

    /* Transiciones para los iconos */
    .hamburger-icon,
    .close-icon {
        transition: all 0.3s ease-in-out;
    }

    .menu-btn .hamburger-icon {
        opacity: 1;
        transform: rotate(0deg);
    }

    .menu-btn .close-icon {
        opacity: 0;
        transform: rotate(-90deg);
    }

    .menu-btn.menu-open .hamburger-icon {
        opacity: 0;
        transform: rotate(90deg);
    }

    .menu-btn.menu-open .close-icon {
        opacity: 1;
        transform: rotate(0deg);
    }

    /* Efectos móviles */
    @media (max-width: 768px) {
        .container {
            padding-left: 1rem;
            padding-right: 1rem;
        }

        .mobile-link:active {
            transform: translateX(4px);
            background-color: rgba(255, 255, 255, 0.15);
        }

        .mobile-link:hover {
            transform: translateX(2px);
        }
    }

    /* Accesibilidad */
    .menu-btn:focus {
        outline: 2px solid rgba(255, 255, 255, 0.5);
        outline-offset: 2px;
    }

    /* Asegurar que el menú sea visible en móvil */
    @media (max-width: 767px) {
        .mobile-menu {
            display: block;
        }

        .mobile-menu > div {
            opacity: 1;
            visibility: visible;
        }
    }
</style>